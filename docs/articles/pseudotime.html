<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comparing pathways over pseudotime • Single Cell Pathway Analysis (SCPA)</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Comparing pathways over pseudotime">
<meta property="og:description" content="SCPA">
<meta property="og:image" content="jackbibby1.github.io/SCPA/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-W1XR84YEPZ"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-W1XR84YEPZ');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Single Cell Pathway Analysis (SCPA)</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">General information</li>
    <li>
      <a href="../articles/interpreting_scpa_output.html">Interpreting the SCPA output</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Generic example</li>
    <li>
      <a href="../articles/quick_start.html">Quick start</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Speeding up SCPA</li>
    <li>
      <a href="../articles/parallel_implementation.html">Parallel processing for faster analysis</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Interacting with gene sets</li>
    <li>
      <a href="../articles/using_gene_sets.html">Using gene sets</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Specific examples</li>
    <li>
      <a href="../articles/comparing_two_populations.html">Comparing two populations</a>
    </li>
    <li>
      <a href="../articles/seurat_comparison.html">Seurat/SingleCellExperiment comparison</a>
    </li>
    <li>
      <a href="../articles/pseudotime.html">Comparing across pseudotime</a>
    </li>
    <li>
      <a href="../articles/systematic_tissue_comparison.html">Systematic comparisons of cells across tissue</a>
    </li>
    <li>
      <a href="../articles/disease_comparison.html">Systems level pathway analysis in disease</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Visualisation</li>
    <li>
      <a href="../articles/visualisation.html">Visualising SCPA output</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jackbibby1/SCPA/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Comparing pathways over pseudotime</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jackbibby1/SCPA/blob/HEAD/vignettes/pseudotime.Rmd" class="external-link"><code>vignettes/pseudotime.Rmd</code></a></small>
      <div class="hidden name"><code>pseudotime.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="multisample-analysis-with-scpa">Multisample analysis with SCPA<a class="anchor" aria-label="anchor" href="#multisample-analysis-with-scpa"></a>
</h2>
<p>Multisample analysis can be performed with SCPA, meaning you can test
pathway activity over multiple populations. This may be useful if you
have multiple time points, or a pseudotime trajectory. The principle is
the same as a two group comparison, but you just need to supply more
populations. For example, if you have three time points, you would
run:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scpa_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_pathways.html">compare_pathways</a></span><span class="op">(</span>samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">pop1</span>, <span class="va">pop2</span>, <span class="va">pop3</span><span class="op">)</span>,</span>
<span>                             pathways <span class="op">=</span> <span class="va">pathways</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="comparing-pathways-across-pseudotime-with-scpa">Comparing pathways across pseudotime with SCPA<a class="anchor" aria-label="anchor" href="#comparing-pathways-across-pseudotime-with-scpa"></a>
</h2>
<p>Here we’re going to look at tracking gene set changes across a
pseudotime trajectory, using the multisample capability of SCPA. To do
this, we’ll use a dataset that we generated where naive CD4<sup>+</sup>
T cells were left unstimulated, or stimulated for 12 or 24 hours with
anti-CD3 and anti-CD28. You can find this dataset <a href="https://drive.google.com/file/d/1XstWBD4lOY0QNd-8Wzeh1f3-uYKuUU5Q/view?usp=sharing" class="external-link">here</a>,
and this analysis will replicate Figure 4 from <a href="https://www.cell.com/cell-reports/fulltext/S2211-1247(22)01571-6" class="external-link">our
paper</a>. We’ll do a systematic analysis of how metabolic pathways are
transcriptionally regulated throughout naive CD4<sup>+</sup> T cell
activation.</p>
<p>Let’s load in a few packages to start</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jackbibby1.github.io/SCPA/">SCPA</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dynverse/dyno" class="external-link">dyno</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/ComplexHeatmap" class="external-link">ComplexHeatmap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/circlize" class="external-link">circlize</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="load-in-data">Load in data<a class="anchor" aria-label="anchor" href="#load-in-data"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">naive_cd4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"naive_cd4.rds"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="quick-look-at-the-data">Quick look at the data<a class="anchor" aria-label="anchor" href="#quick-look-at-the-data"></a>
</h3>
<p>We can see that the populations include both naive/activated T cells,
and Tregs</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">naive_cd4</span>, split.by <span class="op">=</span> <span class="st">"Hour"</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/naive_cd4_umap.png" style="width:100.0%"></p>
</div>
<div class="section level3">
<h3 id="filter-out-cells-we-dont-want">Filter out cells we don’t want<a class="anchor" aria-label="anchor" href="#filter-out-cells-we-dont-want"></a>
</h3>
<p>We’ll get rid of the Tregs because we’re just interested in naive T
cell activation in the non Treg populations</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">naive_cd4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">naive_cd4</span>, idents <span class="op">=</span> <span class="st">"Treg"</span>, invert <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-trajectory-using-the-dyno-workflow">Model trajectory using the dyno workflow<a class="anchor" aria-label="anchor" href="#model-trajectory-using-the-dyno-workflow"></a>
</h3>
<p>We’ll then take the top 1000 most variable genes to model a
trajectory</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">naive_cd4</span><span class="op">[[</span><span class="st">"RNA"</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="va">var_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">1</span>, <span class="va">var</span><span class="op">)</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">1000</span><span class="op">]</span></span></code></pre></div>
<p>And then these steps are broadly taken from the <a href="https://dynverse.org/users/3-user-guide/" class="external-link">dyno vignettes</a>.
We’re just taking expression data and adding it to the object so it’s
able to be used in the <code>infer_trajectory</code> function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu">t</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">naive_cd4</span><span class="op">@</span><span class="va">assays</span><span class="op">$</span><span class="va">RNA</span><span class="op">@</span><span class="va">counts</span><span class="op">[</span><span class="va">var_genes</span>,<span class="op">]</span><span class="op">)</span>, <span class="st">'sparseMatrix'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">expression</span> <span class="op">&lt;-</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu">t</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">naive_cd4</span><span class="op">@</span><span class="va">assays</span><span class="op">$</span><span class="va">RNA</span><span class="op">@</span><span class="va">data</span><span class="op">[</span><span class="va">var_genes</span>,<span class="op">]</span><span class="op">)</span>, <span class="st">'sparseMatrix'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dataset_n4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dynwrap/man/wrap_expression.html" class="external-link">wrap_expression</a></span><span class="op">(</span>expression <span class="op">=</span> <span class="va">expression</span>,</span>
<span>                              counts <span class="op">=</span> <span class="va">counts</span><span class="op">)</span></span></code></pre></div>
<p>And finally running the <code>infer_trajectory</code> function using
slingshot as the modeller</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_n4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dynwrap/man/infer_trajectories.html" class="external-link">infer_trajectory</a></span><span class="op">(</span><span class="va">dataset_n4</span>, method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dynmethods/man/ti_slingshot.html" class="external-link">ti_slingshot</a></span><span class="op">(</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p>We can visualise the trajectory</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/dynplot/man/plot_dimred.html" class="external-link">plot_dimred</a></span><span class="op">(</span><span class="va">model_n4</span>, </span>
<span>            <span class="st">"pseudotime"</span>, </span>
<span>            pseudotime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dynwrap/man/add_pseudotime.html" class="external-link">calculate_pseudotime</a></span><span class="op">(</span><span class="va">model_n4</span><span class="op">)</span>, </span>
<span>            hex_cells <span class="op">=</span> <span class="cn">F</span>,</span>
<span>            plot_trajectory <span class="op">=</span> <span class="cn">T</span>, </span>
<span>            size_cells <span class="op">=</span> <span class="fl">1</span>, alpha_cells <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/naive_cd4_pseudo.png" style="width:50.0%"></p>
<p>Once we have our trajectory calculated, we can generate distinct
nodes of cells across the trajectory to use as an input for SCPA. To
generate the nodes, we can use the
<code>group_onto_nearest_milestones</code> function, which assigns each
cell to a node based on it’s pseudotime value.</p>
<p>We can then visualize the nodes that are calculated across the
trajectory to see what we’re extracting</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/dynplot/man/plot_dimred.html" class="external-link">plot_dimred</a></span><span class="op">(</span><span class="va">model_n4</span>, </span>
<span>            grouping <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/dynwrap/man/group_from_trajectory.html" class="external-link">group_onto_nearest_milestones</a></span><span class="op">(</span><span class="va">model_n4</span><span class="op">)</span>, </span>
<span>            hex_cells <span class="op">=</span> <span class="cn">F</span>,</span>
<span>            plot_trajectory <span class="op">=</span> <span class="cn">T</span>, </span>
<span>            size_cells <span class="op">=</span> <span class="fl">1</span>, alpha_cells <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>aspect.ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/naive_cd4_milestone.png" style="width:50.0%"></p>
<p>And extract the cells based on this grouping</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mile_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/dynwrap/man/group_from_trajectory.html" class="external-link">group_onto_nearest_milestones</a></span><span class="op">(</span><span class="va">model_n4</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html" class="external-link">set_colnames</a></span><span class="op">(</span><span class="st">"milestone"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames_to_column</a></span><span class="op">(</span><span class="st">"cell"</span><span class="op">)</span></span></code></pre></div>
<p>Once we have the pseudotime groupings, we can add this information to
the Seurat object.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">naive_cd4</span><span class="op">$</span><span class="va">milestone</span> <span class="op">&lt;-</span> <span class="va">mile_group</span><span class="op">$</span><span class="va">milestone</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extract-expression-data-for-the-populations-were-comparing">Extract expression data for the populations we’re comparing<a class="anchor" aria-label="anchor" href="#extract-expression-data-for-the-populations-were-comparing"></a>
</h3>
<p>We then need to extract expression matrices for all the cells across
the distinct nodes, so we effectively have 4 populations across the
trajectory. We can use these expression matrices to assess pathways
across the 4 nodes.</p>
<p>We can loop the <code>seurat_extract</code> function to get
expression matrices for all cells in each population. If you have a
SingleCellExperiment object, you can use the <code>sce_extract</code>
function.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cd4_pseudo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">mile_group</span><span class="op">$</span><span class="va">milestone</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cd4_pseudo</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/seurat_extract.html">seurat_extract</a></span><span class="op">(</span><span class="va">naive_cd4</span>, meta1 <span class="op">=</span> <span class="st">"milestone"</span>, value_meta1 <span class="op">=</span> <span class="va">i</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="define-pathways-and-run-comparison">Define pathways and run comparison<a class="anchor" aria-label="anchor" href="#define-pathways-and-run-comparison"></a>
</h3>
<p>Now all the hard work is done, we just need to give this information
to SCPA to analyse pathways over pseudotime, after defining the
pathways. Here we’re using a curated list of metabolic pathways taken
from Hallmark, KEGG, and Reactome databases that you can find <a href="https://github.com/jackbibby1/SCPA/blob/main/gene_sets/" class="external-link">here</a></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pathways</span> <span class="op">&lt;-</span> <span class="st">"combined_metabolic_pathways.csv"</span></span>
<span></span>
<span><span class="va">cd4_metabolism</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_pathways.html">compare_pathways</a></span><span class="op">(</span>samples <span class="op">=</span> <span class="va">cd4_pseudo</span>, </span>
<span>                                   pathways <span class="op">=</span> <span class="va">pathways</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For faster analysis with parallel processing, use 'parallel = TRUE' and 'cores = x' arguments</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plot-a-global-summary-of-the-data">Plot a global summary of the data<a class="anchor" aria-label="anchor" href="#plot-a-global-summary-of-the-data"></a>
</h3>
<p>All done. Let’s plot the data (some annotations have been added later
to highlight pathways)</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cd4_metabolism</span> <span class="op">&lt;-</span> <span class="va">cd4_metabolism</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Pathway</span>, <span class="va">qval</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">column_to_rownames</a></span><span class="op">(</span><span class="st">"Pathway"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">col_hm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/circlize/man/colorRamp2.html" class="external-link">colorRamp2</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"red"</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">mstone_out</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html" class="external-link">Heatmap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">cd4_metabolism</span><span class="op">)</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"Qvalue"</span>,</span>
<span>        col <span class="op">=</span> <span class="va">col_hm</span>,</span>
<span>        border <span class="op">=</span> <span class="cn">T</span>,</span>
<span>        rect_gp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"white"</span>, lwd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>        heatmap_height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"cm"</span><span class="op">)</span>,</span>
<span>        show_column_dend <span class="op">=</span> <span class="cn">F</span>,</span>
<span>        show_row_names <span class="op">=</span> <span class="cn">F</span>,</span>
<span>        show_column_names <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/metabolic_heatmap.png" style="width:70.0%"></p>
</div>
<div class="section level3">
<h3 id="highlight-pathway-by-rank">Highlight pathway by rank<a class="anchor" aria-label="anchor" href="#highlight-pathway-by-rank"></a>
</h3>
<p>We can also extract a single pathway to highlight its rank in the
analysis using the <code>plot_rank</code> function. There are lots of
glycolysis pathways near the top of the list, but we’ll just highlight
one.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_rank.html">plot_rank</a></span><span class="op">(</span>scpa_out <span class="op">=</span> <span class="va">cd4_metabolism</span>, </span>
<span>          pathway <span class="op">=</span> <span class="st">"hallmark_gly"</span>,</span>
<span>          base_point_size <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>          highlight_point_size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/pseudotime_rank.png" style="width:40.0%"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jack Bibby, Divyansh Agarwal.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
